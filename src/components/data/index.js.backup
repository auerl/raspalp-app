import React, { Component } from 'react';
import { ScrollView, View, Text, TextInput, FlatList } from 'react-native';
import { connect } from 'react-redux';
import { Actions } from 'react-native-router-flux';
import { deviceDataAction } from '../../actions/DeviceDataActions';
import { Card, CardSection, Spinner } from '../common';
import { dataStyle, itemStyle } from './style'
import { utcToIso } from '../../utils/time'

import PureChart from 'react-native-pure-chart';


class DeviceData extends Component {

    componentDidMount() {
        if (this.props.item && this.props.item.device_id) {
            this.props.deviceDataAction(
                this.props.item.device_id,
                this.props.userToken,
                'temperature',
                1464141239.78,
                1564138279.23
            );
            console.log("yay");
        }

    }

    componentWillReceiveProps(nextProps) {
        if (nextProps.data) {
            console.log("component update data");
        }
    }

    render() {
        const { containerStyle, titleText, baseText, bottomText } = dataStyle;
        console.log(this.props)
        if (this.props.loading) {
            return <Spinner size="large" />;
        }
        const { serial_number, device_id, name, created, status } = this.props.item;
        let sampleData = [
            {x: '2018-01-01', y: 30},
            {x: '2018-01-02', y: 200},
            {x: '2018-01-03', y: 170},
            {x: '2018-01-04', y: 250},
            {x: '2018-01-05', y: 10}
        ]

        let sampleData2 = [
          {
            seriesName: 'series1',
            data: [
              {x: '2018-02-01', y: 30},
              {x: '2018-02-02', y: 200},
              {x: '2018-02-03', y: 170},
              {x: '2018-02-04', y: 250},
              {x: '2018-02-05', y: 10}
            ],
            color: '#297AB1'
          },
          {
            seriesName: 'series2',
            data: [
              {x: '2018-02-01', y: 20},
              {x: '2018-02-02', y: 100},
              {x: '2018-02-03', y: 140},
              {x: '2018-02-04', y: 550},
              {x: '2018-02-05', y: 40}
            ],
            color: 'yellow'
          }
        ]
        let sampleData3 = [
          {
            value: 50,
            label: 'Marketing',
            color: 'red',
          }, {
            value: 40,
            label: 'Sales',
            color: 'blue'
          }, {
            value: 25,
            label: 'Support',
            color: 'green'
          }
        ]


        return (<ScrollView style={containerStyle}>
                  <Card>
                    <CardSection>
                      <Text style={titleText}>{name}</Text>
                    </CardSection>
                    <Text style={baseText}>Serial number: {serial_number}</Text>
                    <Text style={baseText}>Device ID: {device_id}</Text>
                    <Text style={baseText}>Status: {status}</Text>
                    <Text style={bottomText}>Created: {utcToIso(created)}</Text>
                  </Card>
                  <View paddingTop={20}>
                  <PureChart
                    backgroundColor={"e9e9ef"}
                    data={sampleData}
                    type='line'
                    width={"70%"}
                    height={100}
                    />
                  </View>
                  <View paddingTop={20}>
                  <PureChart
                    backgroundColor={"e9e9ef"}
                    data={sampleData2}
                    type='line'
                    width={"70%"}
                    height={100}
                    />
                  </View>
                  <View paddingTop={20}>
                  <PureChart
                    backgroundColor={"e9e9ef"}
                    data={sampleData}
                    type='bar'
                    width={"70%"}
                    height={100}
                    />
                  </View>
                  <View paddingTop={20}>
                  <PureChart
                    backgroundColor={"e9e9ef"}
                    data={sampleData3}
                    type='pie'
                    width={"70%"}
                    height={100}
                    />
                  </View>
                </ScrollView>

               );
    }
}

const mapStateToProps = state => ({
    data: state.deviceData.data || [],
    loading: state.deviceData.loading,
    userToken: state.login.userToken,
});

export default connect(mapStateToProps, { deviceDataAction })(DeviceData);
